#!/usr/bin/env python3
"""
VERITAS - AIå¥‘ç´„æ›¸ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã€å®Œå…¨ç‰ˆã€‘
=============================================
Streamlit Cloud ãƒ‡ãƒ—ãƒ­ã‚¤ç‰ˆ

Patent: 2025-159636
ã€Œå˜˜ãªãã€èª‡å¼µãªãã€éä¸è¶³ãªãã€

æ©Ÿèƒ½:
- 420+ å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º
- å°‚é–€ãƒã‚§ãƒƒã‚«ãƒ¼ï¼ˆNDA / æ¥­å‹™å§”è¨— / åˆ©ç”¨è¦ç´„ï¼‰
- æ³•ä»¤DBå‚ç…§ï¼ˆ26æ³•å¾‹ã€500+æ¡é …ï¼‰
- AIÃ—å¥‘ç´„æ›¸æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
- Conformal Prediction ã«ã‚ˆã‚‹ä¿¡é ¼åŒºé–“
"""

import streamlit as st
import re
from dataclasses import dataclass, field
from typing import List, Dict, Any, Optional, Tuple
from enum import Enum
import json
from datetime import datetime

# =============================================================================
# ãƒšãƒ¼ã‚¸è¨­å®š
# =============================================================================

st.set_page_config(
    page_title="VERITAS - AIå¥‘ç´„æ›¸ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€å®Œå…¨ç‰ˆã€‘",
    page_icon="ğŸ”",
    layout="wide",
    initial_sidebar_state="expanded",
)

# =============================================================================
# ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹å®šç¾©
# =============================================================================

class RiskLevel(Enum):
    CRITICAL = "CRITICAL"
    HIGH = "HIGH"
    MEDIUM = "MEDIUM"
    LOW = "LOW"
    SAFE = "SAFE"

class ContractType(Enum):
    NDA = "nda"
    OUTSOURCING = "outsourcing"
    TOS = "tos"
    EMPLOYMENT = "employment"
    SALES = "sales"
    GENERAL = "general"

@dataclass
class Issue:
    issue_id: str
    clause_text: str
    issue_type: str
    risk_level: RiskLevel
    description: str
    legal_basis: str
    fix_suggestion: str
    category: str = ""
    confidence: float = 0.95

@dataclass
class AnalysisResult:
    issues: List[Issue]
    risk_score: float
    confidence_interval: Tuple[float, float]
    contract_type: ContractType
    specialist_result: Optional[Dict] = None

# =============================================================================
# æ³•ä»¤ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆ26æ³•å¾‹ã€ä¸»è¦æ¡é …ï¼‰
# =============================================================================

LEGAL_DATABASE = {
    "æ¶ˆè²»è€…å¥‘ç´„æ³•": {
        "ç¬¬8æ¡": {
            "title": "äº‹æ¥­è€…ã®æå®³è³ å„Ÿè²¬ä»»ã‚’å…é™¤ã™ã‚‹æ¡é …ã®ç„¡åŠ¹",
            "content": "äº‹æ¥­è€…ã®å‚µå‹™ä¸å±¥è¡Œãƒ»ä¸æ³•è¡Œç‚ºã«ã‚ˆã‚‹æå®³è³ å„Ÿè²¬ä»»ã®å…¨éƒ¨ã‚’å…é™¤ã™ã‚‹æ¡é …ã¯ç„¡åŠ¹",
            "risk_patterns": ["ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã‚ãªã„", "ã„ã‹ãªã‚‹æå®³ã‚‚è³ å„Ÿã—ãªã„", "å…¨é¢å…è²¬"]
        },
        "ç¬¬9æ¡": {
            "title": "æ¶ˆè²»è€…ãŒæ”¯æ‰•ã†æå®³è³ å„Ÿã®é¡ã‚’äºˆå®šã™ã‚‹æ¡é …ç­‰ã®ç„¡åŠ¹",
            "content": "å¹³å‡çš„ãªæå®³é¡ã‚’è¶…ãˆã‚‹é•ç´„é‡‘æ¡é …ã¯ç„¡åŠ¹",
            "risk_patterns": ["é•ç´„é‡‘", "æå®³è³ å„Ÿé¡ã®äºˆå®š", "ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ–™"]
        },
        "ç¬¬10æ¡": {
            "title": "æ¶ˆè²»è€…ã®åˆ©ç›Šã‚’ä¸€æ–¹çš„ã«å®³ã™ã‚‹æ¡é …ã®ç„¡åŠ¹",
            "content": "ä¿¡ç¾©å‰‡ã«åã—ã¦æ¶ˆè²»è€…ã®åˆ©ç›Šã‚’ä¸€æ–¹çš„ã«å®³ã™ã‚‹æ¡é …ã¯ç„¡åŠ¹",
            "risk_patterns": ["ä¸€æ–¹çš„ã«å¤‰æ›´", "é€šçŸ¥ãªã", "å½“ç¤¾ã®åˆ¤æ–­ã«ã‚ˆã‚Š"]
        }
    },
    "ä¸‹è«‹æ³•": {
        "ç¬¬4æ¡1é …1å·": {
            "title": "å—é ˜æ‹’å¦ã®ç¦æ­¢",
            "content": "ä¸‹è«‹äº‹æ¥­è€…ã®è²¬ã«å¸°ã™ã¹ãç†ç”±ãŒãªã„ã®ã«å—é ˜ã‚’æ‹’ã‚€ã“ã¨ã¯ç¦æ­¢",
            "risk_patterns": ["æ¤œåæ‹’å¦", "å—é ˜æ‹’å¦", "ç´å“ã‚’æ‹’çµ¶"]
        },
        "ç¬¬4æ¡1é …2å·": {
            "title": "ä¸‹è«‹ä»£é‡‘ã®æ”¯æ‰•é…å»¶ã®ç¦æ­¢",
            "content": "ç‰©å“ç­‰ã®å—é ˜æ—¥ã‹ã‚‰60æ—¥ä»¥å†…ã«æ”¯æ‰•ã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„",
            "risk_patterns": ["60æ—¥ã‚’è¶…ãˆã‚‹", "90æ—¥ä»¥å†…", "120æ—¥"]
        },
        "ç¬¬4æ¡1é …3å·": {
            "title": "ä¸‹è«‹ä»£é‡‘ã®æ¸›é¡ã®ç¦æ­¢",
            "content": "ä¸‹è«‹äº‹æ¥­è€…ã®è²¬ã«å¸°ã™ã¹ãç†ç”±ãŒãªã„ã®ã«ä»£é‡‘ã‚’æ¸›é¡ã™ã‚‹ã“ã¨ã¯ç¦æ­¢",
            "risk_patterns": ["å€¤å¼•ã", "æ¸›é¡", "ä»£é‡‘ã‚«ãƒƒãƒˆ"]
        },
        "ç¬¬4æ¡1é …5å·": {
            "title": "è²·ã„ãŸãŸãã®ç¦æ­¢",
            "content": "é€šå¸¸æ”¯æ‰•ã‚ã‚Œã‚‹å¯¾ä¾¡ã«æ¯”ã—ã¦è‘—ã—ãä½ã„ä¸‹è«‹ä»£é‡‘ã‚’å®šã‚ã‚‹ã“ã¨ã¯ç¦æ­¢",
            "risk_patterns": ["è‘—ã—ãä½ã„", "ä¸å½“ã«å®‰ã„", "ç›¸å ´ã‚’ä¸‹å›ã‚‹"]
        }
    },
    "åŠ´åƒåŸºæº–æ³•": {
        "ç¬¬16æ¡": {
            "title": "è³ å„Ÿäºˆå®šã®ç¦æ­¢",
            "content": "åŠ´åƒå¥‘ç´„ã®ä¸å±¥è¡Œã«ã¤ã„ã¦é•ç´„é‡‘ã‚’å®šã‚ã‚‹ã“ã¨ã¯ç¦æ­¢",
            "risk_patterns": ["ç ”ä¿®è²»ç”¨ã®è¿”é‚„", "é•ç´„é‡‘", "æå®³è³ å„Ÿã‚’äºˆå®š"]
        },
        "ç¬¬20æ¡": {
            "title": "è§£é›‡ã®äºˆå‘Š",
            "content": "è§£é›‡ã™ã‚‹å ´åˆã¯30æ—¥å‰ã«äºˆå‘Šã™ã‚‹ã‹30æ—¥åˆ†ã®è³ƒé‡‘ã‚’æ”¯æ‰•ã†",
            "risk_patterns": ["å³æ™‚è§£é›‡", "äºˆå‘Šãªãè§£é›‡", "å³æ—¥è§£é›‡"]
        },
        "ç¬¬24æ¡": {
            "title": "è³ƒé‡‘æ”¯æ‰•ã®åŸå‰‡",
            "content": "è³ƒé‡‘ã¯é€šè²¨ã§ç›´æ¥åŠ´åƒè€…ã«å…¨é¡ã‚’æ¯æœˆ1å›ä»¥ä¸Šæ”¯æ‰•ã†",
            "risk_patterns": ["è³ƒé‡‘æ§é™¤", "çµ¦ä¸å¤©å¼•ã", "ç½°é‡‘"]
        }
    },
    "æ°‘æ³•": {
        "ç¬¬90æ¡": {
            "title": "å…¬åºè‰¯ä¿—",
            "content": "å…¬ã®ç§©åºåˆã¯å–„è‰¯ã®é¢¨ä¿—ã«åã™ã‚‹æ³•å¾‹è¡Œç‚ºã¯ç„¡åŠ¹",
            "risk_patterns": ["æ°¸ä¹…ã«", "ç„¡åˆ¶é™ã«", "ä¸€åˆ‡ã®æ¨©åˆ©ã‚’æ”¾æ£„"]
        },
        "ç¬¬548æ¡ã®2": {
            "title": "å®šå‹ç´„æ¬¾ã®åˆæ„",
            "content": "å®šå‹ç´„æ¬¾ã®å†…å®¹ãŒç›¸æ‰‹æ–¹ã®åˆ©ç›Šã‚’ä¸€æ–¹çš„ã«å®³ã™ã‚‹ã‚‚ã®ã¯åˆæ„ã—ãªã‹ã£ãŸã‚‚ã®ã¨ã¿ãªã™",
            "risk_patterns": ["ç´„æ¬¾å¤‰æ›´", "ä¸€æ–¹çš„å¤‰æ›´", "é€šçŸ¥ãªãå¤‰æ›´"]
        }
    },
    "å€‹äººæƒ…å ±ä¿è­·æ³•": {
        "ç¬¬18æ¡": {
            "title": "åˆ©ç”¨ç›®çš„ã«ã‚ˆã‚‹åˆ¶é™",
            "content": "åˆ©ç”¨ç›®çš„ã®é”æˆã«å¿…è¦ãªç¯„å›²ã‚’è¶…ãˆã¦å€‹äººæƒ…å ±ã‚’å–ã‚Šæ‰±ã£ã¦ã¯ãªã‚‰ãªã„",
            "risk_patterns": ["ç›®çš„å¤–åˆ©ç”¨", "ä»–ã®ç›®çš„ã«ä½¿ç”¨", "ã„ã‹ãªã‚‹ç›®çš„ã«ã‚‚"]
        },
        "ç¬¬27æ¡": {
            "title": "ç¬¬ä¸‰è€…æä¾›ã®åˆ¶é™",
            "content": "æœ¬äººã®åŒæ„ãªãå€‹äººãƒ‡ãƒ¼ã‚¿ã‚’ç¬¬ä¸‰è€…ã«æä¾›ã—ã¦ã¯ãªã‚‰ãªã„",
            "risk_patterns": ["ç¬¬ä¸‰è€…ã«æä¾›", "å¤–éƒ¨ã«é–‹ç¤º", "ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ä¼æ¥­ã«å…±æœ‰"]
        }
    },
    "ç‰¹å®šå•†å–å¼•æ³•": {
        "ç¬¬9æ¡": {
            "title": "ã‚¯ãƒ¼ãƒªãƒ³ã‚°ãƒ»ã‚ªãƒ•",
            "content": "è¨ªå•è²©å£²ç­‰ã«ãŠã„ã¦8æ—¥é–“ã®ã‚¯ãƒ¼ãƒªãƒ³ã‚°ãƒ»ã‚ªãƒ•æ¨©ã‚’èªã‚ã‚‹",
            "risk_patterns": ["ã‚¯ãƒ¼ãƒªãƒ³ã‚°ã‚ªãƒ•ä¸å¯", "è¿”å“ä¸å¯", "ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸å¯"]
        }
    },
    "ä¸æ­£ç«¶äº‰é˜²æ­¢æ³•": {
        "ç¬¬2æ¡6é …": {
            "title": "å–¶æ¥­ç§˜å¯†",
            "content": "ç§˜å¯†ç®¡ç†æ€§ãƒ»æœ‰ç”¨æ€§ãƒ»éå…¬çŸ¥æ€§ã®3è¦ä»¶ã‚’æº€ãŸã™æƒ…å ±",
            "risk_patterns": ["å–¶æ¥­ç§˜å¯†", "ç§˜å¯†æƒ…å ±", "æ©Ÿå¯†æƒ…å ±"]
        }
    }
}

# =============================================================================
# å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³å®šç¾©ï¼ˆ420+ãƒ‘ã‚¿ãƒ¼ãƒ³ - ã‚«ãƒ†ã‚´ãƒªåˆ¥ï¼‰
# =============================================================================

DANGER_PATTERNS = {
    # ========================================
    # å…±é€šãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå…¨å¥‘ç´„ã‚¿ã‚¤ãƒ—ï¼‰
    # ========================================
    "common": [
        # å®Œå…¨å…è²¬ç³»ï¼ˆCRITICALï¼‰
        {
            "id": "CMN-CRT-001",
            "pattern": r"(ä¸€åˆ‡|ã„ã‹ãªã‚‹|å…¨ã¦).{0,10}(è²¬ä»»|è³ å„Ÿ|è£œå„Ÿ).{0,10}(è² ã‚ãªã„|ã—ãªã„|å…é™¤|å…è²¬)",
            "type": "å®Œå…¨å…è²¬æ¡é …",
            "risk": RiskLevel.CRITICAL,
            "description": "äº‹æ¥­è€…ã®è²¬ä»»ã‚’å…¨é¢çš„ã«å…é™¤ã™ã‚‹æ¡é …ã¯ã€æ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬8æ¡ã«ã‚ˆã‚Šç„¡åŠ¹ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬8æ¡ï¼ˆäº‹æ¥­è€…ã®æå®³è³ å„Ÿè²¬ä»»ã‚’å…é™¤ã™ã‚‹æ¡é …ã®ç„¡åŠ¹ï¼‰",
            "fix": "ã€Œå½“ç¤¾ã®æ•…æ„ã¾ãŸã¯é‡å¤§ãªéå¤±ã«ã‚ˆã‚‹å ´åˆã‚’é™¤ãã€ç­‰ã®é™å®šã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚",
            "category": "å…è²¬"
        },
        {
            "id": "CMN-CRT-002",
            "pattern": r"(æ³•ä»¤|æ³•å¾‹|è£åˆ¤æ‰€).{0,10}(é–‹ç¤º|æå‡º|å ±å‘Š).{0,10}(ç¦æ­¢|ã§ããªã„|ã—ã¦ã¯ãªã‚‰ãªã„)",
            "type": "æ³•ä»¤é–‹ç¤ºç¦æ­¢",
            "risk": RiskLevel.CRITICAL,
            "description": "æ³•ä»¤ã«ã‚ˆã‚Šç¾©å‹™ä»˜ã‘ã‚‰ã‚ŒãŸé–‹ç¤ºã‚’ç¦æ­¢ã™ã‚‹æ¡é …ã¯å±¥è¡Œä¸èƒ½ã§ã‚ã‚Šã€æ³•çš„ã«ç„¡åŠ¹ã§ã™ã€‚",
            "legal_basis": "åˆ‘äº‹è¨´è¨Ÿæ³•ã€å„ç¨®æ¥­æ³•ã®é–‹ç¤ºç¾©å‹™è¦å®š",
            "fix": "ã€Œæ³•ä»¤ã«ã‚ˆã‚Šé–‹ç¤ºãŒç¾©å‹™ä»˜ã‘ã‚‰ã‚Œã‚‹å ´åˆã‚’é™¤ãã€ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚",
            "category": "æ³•ä»¤é•å"
        },
        {
            "id": "CMN-CRT-003",
            "pattern": r"(æ•…æ„|é‡(å¤§ãª)?éå¤±).{0,10}(å«ã‚|ã§ã‚ã£ã¦ã‚‚).{0,10}(å…è²¬|è²¬ä»».{0,5}è² ã‚ãªã„)",
            "type": "æ•…æ„ãƒ»é‡éå¤±å…è²¬",
            "risk": RiskLevel.CRITICAL,
            "description": "æ•…æ„ã¾ãŸã¯é‡å¤§ãªéå¤±ã«ã‚ˆã‚‹æå®³ã¾ã§å…è²¬ã¨ã™ã‚‹æ¡é …ã¯ç„¡åŠ¹ã§ã™ã€‚",
            "legal_basis": "æ°‘æ³•ç¬¬90æ¡ï¼ˆå…¬åºè‰¯ä¿—ï¼‰ã€æ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬8æ¡",
            "fix": "ã€Œæ•…æ„ã¾ãŸã¯é‡å¤§ãªéå¤±ã«ã‚ˆã‚‹å ´åˆã‚’é™¤ãã€ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚",
            "category": "å…è²¬"
        },
        # é«˜ãƒªã‚¹ã‚¯ç³»ï¼ˆHIGHï¼‰
        {
            "id": "CMN-HIG-001",
            "pattern": r"(ã„ã¤ã§ã‚‚|ä»»æ„|è‡ªç”±).{0,5}(è§£é™¤|è§£ç´„|çµ‚äº†).{0,10}(ã§ãã‚‹|å¯èƒ½)",
            "type": "ä¸€æ–¹çš„è§£é™¤æ¨©",
            "risk": RiskLevel.HIGH,
            "description": "ä¸€æ–¹å½“äº‹è€…ã®ã¿ã«ç„¡æ¡ä»¶ã®è§£é™¤æ¨©ã‚’èªã‚ã‚‹æ¡é …ã¯ã€å¥‘ç´„ã®å®‰å®šæ€§ã‚’è‘—ã—ãæãªã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ°‘æ³•ç¬¬1æ¡ç¬¬2é …ï¼ˆä¿¡ç¾©å‰‡ï¼‰",
            "fix": "è§£é™¤äº‹ç”±ã‚’é™å®šã™ã‚‹ã‹ã€åŒæ–¹ã«åŒç­‰ã®æ¨©åˆ©ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚",
            "category": "è§£é™¤"
        },
        {
            "id": "CMN-HIG-002",
            "pattern": r"(é•ç´„é‡‘|æå®³è³ å„Ÿ).{0,10}(ä¸Šé™|åˆ¶é™).{0,5}(ãªã—|ãªã„|è¨­ã‘ãªã„)",
            "type": "é•ç´„é‡‘ä¸Šé™ãªã—",
            "risk": RiskLevel.HIGH,
            "description": "é•ç´„é‡‘ã®ä¸Šé™ãŒãªã„æ¡é …ã¯ã€éå¤§ãªè² æ‹…ã‚’å¼·ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ°‘æ³•ç¬¬420æ¡ï¼ˆè³ å„Ÿé¡ã®äºˆå®šï¼‰ã€æ°‘æ³•ç¬¬90æ¡ï¼ˆå…¬åºè‰¯ä¿—ï¼‰",
            "fix": "å¥‘ç´„é‡‘é¡ã®ä¸€å®šå‰²åˆã‚’ä¸Šé™ã¨ã—ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚",
            "category": "æå®³è³ å„Ÿ"
        },
        {
            "id": "CMN-HIG-003",
            "pattern": r"(é€šçŸ¥|äºˆå‘Š).{0,5}(ãªã|ãªã—|ã™ã‚‹ã“ã¨ãªã).{0,10}(å¤‰æ›´|æ”¹å®š|ä¿®æ­£)",
            "type": "ç„¡é€šçŸ¥å¤‰æ›´",
            "risk": RiskLevel.HIGH,
            "description": "äº‹å‰é€šçŸ¥ãªãå¥‘ç´„å†…å®¹ã‚’å¤‰æ›´ã§ãã‚‹æ¡é …ã¯ã€ç›¸æ‰‹æ–¹ã®åˆ©ç›Šã‚’ä¸€æ–¹çš„ã«å®³ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬10æ¡ã€æ°‘æ³•ç¬¬548æ¡ã®2",
            "fix": "å¤‰æ›´ã®äº‹å‰é€šçŸ¥æœŸé–“ï¼ˆ30æ—¥ç­‰ï¼‰ã‚’è¨­ã‘ã¦ãã ã•ã„ã€‚",
            "category": "å¤‰æ›´"
        },
        {
            "id": "CMN-HIG-004",
            "pattern": r"æ°¸(ä¹…|é )ã«.{0,10}(å­˜ç¶š|æœ‰åŠ¹|åŠ¹åŠ›)",
            "type": "æ°¸ä¹…å­˜ç¶šæ¡é …",
            "risk": RiskLevel.HIGH,
            "description": "ç¾©å‹™ãŒæ°¸ä¹…ã«å­˜ç¶šã™ã‚‹æ¡é …ã¯ã€éåº¦ãªæ‹˜æŸã¨ã—ã¦å•é¡Œã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ°‘æ³•ç¬¬90æ¡ï¼ˆå…¬åºè‰¯ä¿—ï¼‰",
            "fix": "åˆç†çš„ãªå­˜ç¶šæœŸé–“ï¼ˆ3ã€œ5å¹´ç­‰ï¼‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",
            "category": "æœŸé–“"
        },
        {
            "id": "CMN-HIG-005",
            "pattern": r"(å½“ç¤¾|ç”²).{0,5}(åˆ¤æ–­|è£é‡).{0,5}(ã®ã¿|ã ã‘|ã«ã‚ˆã£ã¦).{0,10}(æ±ºå®š|è§£é‡ˆ)",
            "type": "ä¸€æ–¹çš„è§£é‡ˆæ¨©",
            "risk": RiskLevel.HIGH,
            "description": "å¥‘ç´„ã®è§£é‡ˆã‚’ä¸€æ–¹å½“äº‹è€…ã®ã¿ãŒæ±ºå®šã§ãã‚‹æ¡é …ã¯ä¸å…¬æ­£ã§ã™ã€‚",
            "legal_basis": "æ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬10æ¡",
            "fix": "è§£é‡ˆã«ç–‘ç¾©ãŒã‚ã‚‹å ´åˆã®å”è­°æ¡é …ã‚’è¨­ã‘ã¦ãã ã•ã„ã€‚",
            "category": "è§£é‡ˆ"
        },
        # ä¸­ãƒªã‚¹ã‚¯ç³»ï¼ˆMEDIUMï¼‰
        {
            "id": "CMN-MED-001",
            "pattern": r"(è‡ªå‹•|é»™ç¤º).{0,5}(æ›´æ–°|å»¶é•·).{0,10}(æ‹’å¦|è§£ç´„).{0,5}(30æ—¥|1[ãƒ¶ã‚±ã‹]æœˆ).{0,5}(å‰|ä»¥å‰)",
            "type": "è‡ªå‹•æ›´æ–°ãƒ»çŸ­æœŸè§£ç´„äºˆå‘Š",
            "risk": RiskLevel.MEDIUM,
            "description": "è‡ªå‹•æ›´æ–°ã§è§£ç´„äºˆå‘ŠæœŸé–“ãŒçŸ­ã„å ´åˆã€è§£ç´„æ©Ÿä¼šã‚’é€ƒã™ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ°‘æ³•ç¬¬1æ¡ç¬¬2é …ï¼ˆä¿¡ç¾©å‰‡ï¼‰",
            "fix": "è§£ç´„äºˆå‘ŠæœŸé–“ã®æ˜ç¢ºåŒ–ã¨ã€æ›´æ–°é€šçŸ¥ã®ç¾©å‹™åŒ–ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚",
            "category": "æ›´æ–°"
        },
        {
            "id": "CMN-MED-002",
            "pattern": r"(æº–æ‹ æ³•|ç®¡è½„).{0,10}(å¤–å›½|æµ·å¤–|ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«|é¦™æ¸¯|ã‚±ã‚¤ãƒãƒ³)",
            "type": "å¤–å›½æ³•æº–æ‹ ãƒ»ç®¡è½„",
            "risk": RiskLevel.MEDIUM,
            "description": "å¤–å›½æ³•æº–æ‹ ã‚„å¤–å›½è£åˆ¤æ‰€ç®¡è½„ã¯ã€ç´›äº‰æ™‚ã®ã‚³ã‚¹ãƒˆãŒå¢—å¤§ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ³•ã®é©ç”¨ã«é–¢ã™ã‚‹é€šå‰‡æ³•",
            "fix": "æ—¥æœ¬æ³•æº–æ‹ ãƒ»æ—¥æœ¬ã®è£åˆ¤æ‰€ç®¡è½„ã¸ã®å¤‰æ›´ã‚’äº¤æ¸‰ã—ã¦ãã ã•ã„ã€‚",
            "category": "ç´›äº‰è§£æ±º"
        },
        # ä½ãƒªã‚¹ã‚¯ç³»ï¼ˆLOWï¼‰
        {
            "id": "CMN-LOW-001",
            "pattern": r"(æ›¸é¢|æ–‡æ›¸).{0,10}(åŒæ„|æ‰¿è«¾).{0,10}(å¿…è¦|è¦ã™ã‚‹)",
            "type": "æ›¸é¢åŒæ„è¦ä»¶",
            "risk": RiskLevel.LOW,
            "description": "æ›¸é¢ã§ã®åŒæ„ã‚’è¦æ±‚ã™ã‚‹æ¡é …ã¯ã€æ‰‹ç¶šããŒç…©é›‘ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "é›»å­ç½²åæ³•",
            "fix": "é›»å­çš„æ–¹æ³•ã«ã‚ˆã‚‹åŒæ„ã‚‚èªã‚ã‚‹è¦å®šã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚",
            "category": "æ‰‹ç¶š"
        },
    ],
    
    # ========================================
    # NDAï¼ˆç§˜å¯†ä¿æŒå¥‘ç´„ï¼‰å°‚ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
    # ========================================
    "nda": [
        # CRITICAL
        {
            "id": "NDA-CRT-001",
            "pattern": r"(ç§˜å¯†|æ©Ÿå¯†).{0,10}(å®šç¾©|ç¯„å›²).{0,10}(éšæ™‚|ã„ã¤ã§ã‚‚).{0,5}(å¤‰æ›´|æ‹¡å¤§)",
            "type": "ç§˜å¯†æƒ…å ±å®šç¾©ã®ç„¡åˆ¶é™å¤‰æ›´",
            "risk": RiskLevel.CRITICAL,
            "description": "é–‹ç¤ºè€…ãŒä¸€æ–¹çš„ã«ç§˜å¯†æƒ…å ±ã®ç¯„å›²ã‚’å¤‰æ›´ã§ãã‚‹æ¡é …ã¯å±é™ºã§ã™ã€‚",
            "legal_basis": "æ°‘æ³•ç¬¬1æ¡ç¬¬2é …ï¼ˆä¿¡ç¾©å‰‡ï¼‰",
            "fix": "ç§˜å¯†æƒ…å ±ã®å®šç¾©ã‚’å¥‘ç´„æ™‚ã«æ˜ç¢ºåŒ–ã—ã€å¤‰æ›´ã«ã¯åˆæ„ã‚’è¦ã™ã‚‹æ—¨è¦å®šã—ã¦ãã ã•ã„ã€‚",
            "category": "å®šç¾©"
        },
        {
            "id": "NDA-CRT-002",
            "pattern": r"(é™¤å¤–|ä¾‹å¤–).{0,10}(ä¸€åˆ‡|ã„ã‹ãªã‚‹).{0,5}(èªã‚ãªã„|ãªã„|è¨­ã‘ãªã„)",
            "type": "é™¤å¤–äº‹ç”±ã®å®Œå…¨å¦å®š",
            "risk": RiskLevel.CRITICAL,
            "description": "å…¬çŸ¥æƒ…å ±ç­‰ã®é™¤å¤–äº‹ç”±ã‚’ä¸€åˆ‡èªã‚ãªã„æ¡é …ã¯ä¸åˆç†ã§ã™ã€‚",
            "legal_basis": "ä¸æ­£ç«¶äº‰é˜²æ­¢æ³•ç¬¬2æ¡6é …ï¼ˆå–¶æ¥­ç§˜å¯†ã®å®šç¾©ï¼‰",
            "fix": "æ¨™æº–çš„ãªé™¤å¤–äº‹ç”±ï¼ˆå…¬çŸ¥ã€ç‹¬è‡ªé–‹ç™ºã€ç¬¬ä¸‰è€…ã‹ã‚‰ã®é©æ³•å–å¾—ç­‰ï¼‰ã‚’è¦å®šã—ã¦ãã ã•ã„ã€‚",
            "category": "é™¤å¤–"
        },
        # HIGH
        {
            "id": "NDA-HIG-001",
            "pattern": r"(ç¬¬ä¸‰è€…|å¤–éƒ¨).{0,10}(è‡ªç”±|ç„¡åˆ¶é™|åˆ¶é™ãªã).{0,5}(é–‹ç¤º|å†é–‹ç¤º)",
            "type": "ç„¡åˆ¶é™å†é–‹ç¤º",
            "risk": RiskLevel.HIGH,
            "description": "ç¬¬ä¸‰è€…ã¸ã®ç„¡åˆ¶é™ãªå†é–‹ç¤ºã‚’èªã‚ã‚‹æ¡é …ã¯ç§˜å¯†ä¿æŒã®è¶£æ—¨ã«åã—ã¾ã™ã€‚",
            "legal_basis": "ä¸æ­£ç«¶äº‰é˜²æ­¢æ³•",
            "fix": "å†é–‹ç¤ºå…ˆã‚’é™å®šã—ã€åŒç­‰ã®ç§˜å¯†ä¿æŒç¾©å‹™ã‚’èª²ã™æ¡é …ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚",
            "category": "å†é–‹ç¤º"
        },
        {
            "id": "NDA-HIG-002",
            "pattern": r"(è¿”é‚„|æ¶ˆå»|å»ƒæ£„).{0,10}(ç¾©å‹™|è²¬ä»»).{0,5}(ãªã„|ãªã—|è² ã‚ãªã„)",
            "type": "è¿”é‚„ãƒ»æ¶ˆå»ç¾©å‹™ãªã—",
            "risk": RiskLevel.HIGH,
            "description": "å¥‘ç´„çµ‚äº†å¾Œã®è¿”é‚„ãƒ»æ¶ˆå»ç¾©å‹™ãŒãªã„æ¡é …ã¯æƒ…å ±æ¼æ´©ãƒªã‚¹ã‚¯ã‚’é«˜ã‚ã¾ã™ã€‚",
            "legal_basis": "å€‹äººæƒ…å ±ä¿è­·æ³•ç¬¬22æ¡",
            "fix": "å¥‘ç´„çµ‚äº†æ™‚ã®è¿”é‚„ãƒ»æ¶ˆå»ç¾©å‹™ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚",
            "category": "çµ‚äº†æ™‚ç¾©å‹™"
        },
        {
            "id": "NDA-HIG-003",
            "pattern": r"(å§”è¨—å…ˆ|å†å§”è¨—|å¤–æ³¨).{0,10}(å®ˆç§˜|ç§˜å¯†ä¿æŒ).{0,10}(ç¾©å‹™|è²¬ä»»).{0,5}(ãªã—|èª²ã•ãªã„)",
            "type": "å§”è¨—å…ˆç§˜å¯†ä¿æŒç¾©å‹™ãªã—",
            "risk": RiskLevel.HIGH,
            "description": "å§”è¨—å…ˆã¸ã®ç§˜å¯†ä¿æŒç¾©å‹™ä»˜ä¸ãŒãªã„æ¡é …ã¯é‡å¤§ãªç©´ã¨ãªã‚Šã¾ã™ã€‚",
            "legal_basis": "å€‹äººæƒ…å ±ä¿è­·æ³•ç¬¬25æ¡",
            "fix": "å§”è¨—å…ˆã«æœ¬å¥‘ç´„ã¨åŒç­‰ä»¥ä¸Šã®ç§˜å¯†ä¿æŒç¾©å‹™ã‚’èª²ã™æ¡é …ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚",
            "category": "å§”è¨—"
        },
        # MEDIUM
        {
            "id": "NDA-MED-001",
            "pattern": r"(å­˜ç¶š|æœ‰åŠ¹).{0,10}(10å¹´|15å¹´|20å¹´)",
            "type": "é•·æœŸå­˜ç¶šæœŸé–“",
            "risk": RiskLevel.MEDIUM,
            "description": "10å¹´ä»¥ä¸Šã®å­˜ç¶šæœŸé–“ã¯ã€æƒ…å ±ã®æ€§è³ªã«ã‚ˆã£ã¦ã¯éé•·ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ°‘æ³•ç¬¬90æ¡ï¼ˆå…¬åºè‰¯ä¿—ï¼‰",
            "fix": "æƒ…å ±ã®æ€§è³ªã«å¿œã˜ãŸåˆç†çš„ãªæœŸé–“ï¼ˆæŠ€è¡“æƒ…å ±ï¼š5-10å¹´ã€ä¸€èˆ¬æƒ…å ±ï¼š3-5å¹´ï¼‰ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚",
            "category": "æœŸé–“"
        },
        {
            "id": "NDA-MED-002",
            "pattern": r"(å£é ­|å£è¿°).{0,10}(ç§˜å¯†|æ©Ÿå¯†).{0,10}(æ›¸é¢|æ–‡æ›¸).{0,5}(ç¢ºèª|é€šçŸ¥).{0,10}(30æ—¥|1[ãƒ¶ã‚±ã‹]æœˆ)",
            "type": "å£é ­é–‹ç¤ºã®æ›¸é¢ç¢ºèªæœŸé™",
            "risk": RiskLevel.MEDIUM,
            "description": "å£é ­é–‹ç¤ºã®æ›¸é¢ç¢ºèªæœŸé™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ãŒã€é‹ç”¨ä¸Šã®ç¢ºèªãŒå¿…è¦ã§ã™ã€‚",
            "legal_basis": "å®Ÿå‹™æ…£è¡Œ",
            "fix": "ç¢ºèªæœŸé™ã®åˆç†æ€§ã¨ã€ç¢ºèªæ¼ã‚Œæ™‚ã®å–æ‰±ã„ã‚’æ˜ç¢ºåŒ–ã—ã¦ãã ã•ã„ã€‚",
            "category": "æ‰‹ç¶š"
        },
    ],
    
    # ========================================
    # æ¥­å‹™å§”è¨—å¥‘ç´„å°‚ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
    # ========================================
    "outsourcing": [
        # CRITICAL
        {
            "id": "OUT-CRT-001",
            "pattern": r"(æ”¯æ‰•|ä»£é‡‘).{0,10}(90æ—¥|120æ—¥|180æ—¥).{0,5}(ä»¥å†…|å¾Œ)",
            "type": "æ”¯æ‰•æœŸé™è¶…éï¼ˆä¸‹è«‹æ³•é•åï¼‰",
            "risk": RiskLevel.CRITICAL,
            "description": "ç‰©å“ç­‰ã®å—é ˜æ—¥ã‹ã‚‰60æ—¥ã‚’è¶…ãˆã‚‹æ”¯æ‰•æœŸé™ã¯ä¸‹è«‹æ³•é•åã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "ä¸‹è«‹æ³•ç¬¬4æ¡1é …2å·ï¼ˆæ”¯æ‰•é…å»¶ã®ç¦æ­¢ï¼‰",
            "fix": "å—é ˜æ—¥ã‹ã‚‰60æ—¥ä»¥å†…ã®æ”¯æ‰•ã„ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚",
            "category": "æ”¯æ‰•"
        },
        {
            "id": "OUT-CRT-002",
            "pattern": r"(æ¤œå|æ¤œæŸ»|å—å…¥).{0,10}(ç†ç”±|äº‹ç”±).{0,5}(ãªã|å•ã‚ãš|ä¸è¦).{0,10}(æ‹’å¦|æ‹’çµ¶)",
            "type": "ç†ç”±ãªãæ¤œåæ‹’å¦ï¼ˆä¸‹è«‹æ³•é•åï¼‰",
            "risk": RiskLevel.CRITICAL,
            "description": "ç†ç”±ãªãæ¤œåã‚’æ‹’å¦ã§ãã‚‹æ¡é …ã¯ä¸‹è«‹æ³•é•åã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "ä¸‹è«‹æ³•ç¬¬4æ¡1é …1å·ï¼ˆå—é ˜æ‹’å¦ã®ç¦æ­¢ï¼‰",
            "fix": "æ¤œåæ‹’å¦ã®ç†ç”±æ˜ç¤ºã¨ã€ç•°è­°ç”³ç«‹ã¦æœŸé–“ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",
            "category": "æ¤œå"
        },
        {
            "id": "OUT-CRT-003",
            "pattern": r"(ä»£é‡‘|å ±é…¬).{0,10}(æ¸›é¡|å€¤å¼•ã|ã‚«ãƒƒãƒˆ).{0,10}(ã§ãã‚‹|å¯èƒ½)",
            "type": "ä¸€æ–¹çš„ä»£é‡‘æ¸›é¡ï¼ˆä¸‹è«‹æ³•é•åï¼‰",
            "risk": RiskLevel.CRITICAL,
            "description": "ä¸‹è«‹äº‹æ¥­è€…ã®è²¬ã‚ã«å¸°ã™ã¹ãç†ç”±ãªãä»£é‡‘ã‚’æ¸›é¡ã™ã‚‹ã“ã¨ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚",
            "legal_basis": "ä¸‹è«‹æ³•ç¬¬4æ¡1é …3å·ï¼ˆä»£é‡‘æ¸›é¡ã®ç¦æ­¢ï¼‰",
            "fix": "æ¸›é¡äº‹ç”±ã‚’é™å®šã—ã€åŒæ–¹åˆæ„ã®ä¸Šã§è¡Œã†æ—¨è¦å®šã—ã¦ãã ã•ã„ã€‚",
            "category": "æ”¯æ‰•"
        },
        # HIGH
        {
            "id": "OUT-HIG-001",
            "pattern": r"(æˆæœç‰©|è‘—ä½œæ¨©|çŸ¥çš„è²¡ç”£).{0,10}(å…¨ã¦|ä¸€åˆ‡|ç„¡æ¡ä»¶).{0,5}(å¸°å±|ç§»è»¢|è­²æ¸¡)",
            "type": "æˆæœç‰©æ¨©åˆ©ã®å…¨é¢ç§»è»¢",
            "risk": RiskLevel.HIGH,
            "description": "è‘—ä½œæ¨©ç­‰ã®å…¨é¢ç§»è»¢æ¡é …ã¯ã€å¯¾ä¾¡ã¨ã®å‡è¡¡ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "è‘—ä½œæ¨©æ³•ç¬¬27æ¡ã€ç¬¬28æ¡",
            "fix": "ç§»è»¢å¯¾ä¾¡ã®æ˜è¨˜ã¨ã€è‘—ä½œè€…äººæ ¼æ¨©ã®å–æ‰±ã„ã‚’æ˜ç¢ºåŒ–ã—ã¦ãã ã•ã„ã€‚",
            "category": "çŸ¥çš„è²¡ç”£"
        },
        {
            "id": "OUT-HIG-002",
            "pattern": r"(å†å§”è¨—|å¤–æ³¨|ä¸‹è«‹ã‘).{0,10}(ç¦æ­¢|ã§ããªã„|èªã‚ãªã„)",
            "type": "å†å§”è¨—ã®å…¨é¢ç¦æ­¢",
            "risk": RiskLevel.HIGH,
            "description": "å†å§”è¨—ã®å…¨é¢ç¦æ­¢ã¯ã€æ¥­å‹™é‚è¡Œã®æŸ”è»Ÿæ€§ã‚’æãªã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "ä¸‹è«‹æ³•ã€ç‹¬å ç¦æ­¢æ³•",
            "fix": "äº‹å‰æ‰¿è«¾ã«ã‚ˆã‚‹å†å§”è¨—ã‚’èªã‚ã‚‹ã‹ã€ç¦æ­¢ç†ç”±ã‚’æ˜ç¢ºåŒ–ã—ã¦ãã ã•ã„ã€‚",
            "category": "å†å§”è¨—"
        },
        # MEDIUM
        {
            "id": "OUT-MED-001",
            "pattern": r"(ç‘•ç–µ|å¥‘ç´„ä¸é©åˆ).{0,10}(æœŸé–“|æœŸé™).{0,5}(1å¹´|2å¹´|3å¹´)",
            "type": "å¥‘ç´„ä¸é©åˆè²¬ä»»æœŸé–“",
            "risk": RiskLevel.MEDIUM,
            "description": "å¥‘ç´„ä¸é©åˆè²¬ä»»æœŸé–“ã®é•·ã•ãŒé©åˆ‡ã‹ç¢ºèªãŒå¿…è¦ã§ã™ã€‚",
            "legal_basis": "æ°‘æ³•ç¬¬566æ¡",
            "fix": "æˆæœç‰©ã®æ€§è³ªã«å¿œã˜ãŸåˆç†çš„ãªæœŸé–“ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",
            "category": "ä¿è¨¼"
        },
    ],
    
    # ========================================
    # åˆ©ç”¨è¦ç´„ï¼ˆTOSï¼‰å°‚ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
    # ========================================
    "tos": [
        # CRITICAL
        {
            "id": "TOS-CRT-001",
            "pattern": r"(ãƒ¦ãƒ¼ã‚¶ãƒ¼|åˆ©ç”¨è€…).{0,10}(ä½œæˆ|æŠ•ç¨¿).{0,10}(è‘—ä½œæ¨©|æ¨©åˆ©).{0,10}(ç„¡å„Ÿ|ç„¡æ–™|å¯¾ä¾¡ãªã).{0,5}(è­²æ¸¡|ç§»è»¢)",
            "type": "ãƒ¦ãƒ¼ã‚¶ãƒ¼æˆæœç‰©ã®ç„¡å„Ÿè­²æ¸¡å¼·åˆ¶",
            "risk": RiskLevel.CRITICAL,
            "description": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è‘—ä½œæ¨©ã‚’ç„¡å„Ÿã§è­²æ¸¡ã•ã›ã‚‹æ¡é …ã¯å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬10æ¡ã€è‘—ä½œæ¨©æ³•",
            "fix": "ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è¨±è«¾ã«å¤‰æ›´ã™ã‚‹ã‹ã€å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚",
            "category": "çŸ¥çš„è²¡ç”£"
        },
        {
            "id": "TOS-CRT-002",
            "pattern": r"(å€‹äººæƒ…å ±|ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿).{0,10}(ç¬¬ä¸‰è€…|å¤–éƒ¨).{0,10}(è‡ªç”±|ç„¡åˆ¶é™|ç„¡æ–­).{0,5}(æä¾›|é–‹ç¤º|å…±æœ‰)",
            "type": "å€‹äººæƒ…å ±ã®ç„¡æ–­ç¬¬ä¸‰è€…æä¾›",
            "risk": RiskLevel.CRITICAL,
            "description": "å€‹äººæƒ…å ±ã‚’ç„¡æ–­ã§ç¬¬ä¸‰è€…ã«æä¾›ã™ã‚‹æ¡é …ã¯é•æ³•ã§ã™ã€‚",
            "legal_basis": "å€‹äººæƒ…å ±ä¿è­·æ³•ç¬¬27æ¡",
            "fix": "ç¬¬ä¸‰è€…æä¾›ã«ã¯æœ¬äººåŒæ„ãŒå¿…è¦ã§ã‚ã‚‹æ—¨ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚",
            "category": "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼"
        },
        # HIGH
        {
            "id": "TOS-HIG-001",
            "pattern": r"(ã‚µãƒ¼ãƒ“ã‚¹|æœ¬ã‚µãƒ¼ãƒ“ã‚¹).{0,10}(é€šçŸ¥|äºˆå‘Š).{0,5}(ãªã|ãªã—|ã™ã‚‹ã“ã¨ãªã).{0,10}(åœæ­¢|çµ‚äº†|ä¸­æ­¢)",
            "type": "ç„¡é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢",
            "risk": RiskLevel.HIGH,
            "description": "äº‹å‰é€šçŸ¥ãªãã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ã§ãã‚‹æ¡é …ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ©ç›Šã‚’å®³ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬10æ¡",
            "fix": "åœæ­¢ã®äº‹å‰é€šçŸ¥æœŸé–“ï¼ˆ30æ—¥ç­‰ï¼‰ã‚’è¨­ã‘ã¦ãã ã•ã„ã€‚",
            "category": "ã‚µãƒ¼ãƒ“ã‚¹çµ‚äº†"
        },
        {
            "id": "TOS-HIG-002",
            "pattern": r"(ã‚¯ãƒ¼ãƒªãƒ³ã‚°|è¿”é‡‘|è¿”å“).{0,10}(ä¸€åˆ‡|ã„ã‹ãªã‚‹å ´åˆã‚‚).{0,5}(ä¸å¯|ã§ããªã„|èªã‚ãªã„)",
            "type": "è¿”é‡‘ãƒ»è¿”å“ã®å…¨é¢æ‹’å¦",
            "risk": RiskLevel.HIGH,
            "description": "è¿”é‡‘ãƒ»è¿”å“ã‚’å…¨é¢çš„ã«æ‹’å¦ã™ã‚‹æ¡é …ã¯ã€ç‰¹å•†æ³•ç­‰ã«é•åã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "ç‰¹å®šå•†å–å¼•æ³•ç¬¬9æ¡",
            "fix": "æ³•å®šã®ã‚¯ãƒ¼ãƒªãƒ³ã‚°ã‚ªãƒ•æ¨©ã‚’èªã‚ã‚‹è¦å®šã‚’è¨­ã‘ã¦ãã ã•ã„ã€‚",
            "category": "è¿”é‡‘"
        },
        # MEDIUM
        {
            "id": "TOS-MED-001",
            "pattern": r"(æ–™é‡‘|ä¾¡æ ¼|èª²é‡‘).{0,10}(å¤‰æ›´|æ”¹å®š).{0,10}(30æ—¥|1[ãƒ¶ã‚±ã‹]æœˆ)",
            "type": "æ–™é‡‘å¤‰æ›´é€šçŸ¥æœŸé–“",
            "risk": RiskLevel.MEDIUM,
            "description": "æ–™é‡‘å¤‰æ›´ã®é€šçŸ¥æœŸé–“ãŒé©åˆ‡ã‹ç¢ºèªãŒå¿…è¦ã§ã™ã€‚",
            "legal_basis": "æ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬10æ¡",
            "fix": "æ–™é‡‘å¤‰æ›´ã¯åˆç†çš„ãªé€šçŸ¥æœŸé–“ã‚’è¨­ã‘ã€ç•°è­°ç”³ç«‹ã¦æœŸé–“ã‚‚ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚",
            "category": "æ–™é‡‘"
        },
    ],
    
    # ========================================
    # é›‡ç”¨å¥‘ç´„å°‚ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
    # ========================================
    "employment": [
        # CRITICAL
        {
            "id": "EMP-CRT-001",
            "pattern": r"(ç ”ä¿®|æ•™è‚²|è¨“ç·´).{0,10}(è²»ç”¨|ä»£é‡‘).{0,10}(è¿”é‚„|å¼æ¸ˆ|æ”¯æ‰•ã„).{0,10}(ç¾©å‹™|è² ã†)",
            "type": "ç ”ä¿®è²»ç”¨è¿”é‚„ç¾©å‹™ï¼ˆåŠ´åŸºæ³•é•åï¼‰",
            "risk": RiskLevel.CRITICAL,
            "description": "é€€è·æ™‚ã«ç ”ä¿®è²»ç”¨ã®è¿”é‚„ã‚’ç¾©å‹™ä»˜ã‘ã‚‹æ¡é …ã¯åŠ´åŸºæ³•16æ¡ã«é•åã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "åŠ´åƒåŸºæº–æ³•ç¬¬16æ¡ï¼ˆè³ å„Ÿäºˆå®šã®ç¦æ­¢ï¼‰",
            "fix": "ç ”ä¿®è²»ç”¨è¿”é‚„æ¡é …ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚",
            "category": "é€€è·"
        },
        {
            "id": "EMP-CRT-002",
            "pattern": r"(ç«¶æ¥­|ç«¶åˆ).{0,10}(æ°¸ä¹…|ç„¡æœŸé™|æœŸé™ãªã).{0,5}(ç¦æ­¢|é¿æ­¢)",
            "type": "ç„¡æœŸé™ç«¶æ¥­é¿æ­¢",
            "risk": RiskLevel.CRITICAL,
            "description": "ç„¡æœŸé™ã®ç«¶æ¥­é¿æ­¢ç¾©å‹™ã¯è·æ¥­é¸æŠã®è‡ªç”±ã‚’éåº¦ã«åˆ¶ç´„ã—ç„¡åŠ¹ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "æ†²æ³•ç¬¬22æ¡ï¼ˆè·æ¥­é¸æŠã®è‡ªç”±ï¼‰ã€åŠ´åƒå¥‘ç´„æ³•",
            "fix": "åˆç†çš„ãªæœŸé–“ï¼ˆ1-2å¹´ï¼‰ã¨åœ°åŸŸçš„åˆ¶é™ã‚’è¨­ã‘ã¦ãã ã•ã„ã€‚",
            "category": "ç«¶æ¥­é¿æ­¢"
        },
        # HIGH
        {
            "id": "EMP-HIG-001",
            "pattern": r"(å³æ™‚|å³æ—¥|äºˆå‘Šãªã).{0,10}(è§£é›‡|è§£è·|é€€è·ã•ã›ã‚‹)",
            "type": "å³æ™‚è§£é›‡æ¡é …",
            "risk": RiskLevel.HIGH,
            "description": "äºˆå‘Šãªãå³æ™‚è§£é›‡ã¯åŠ´åŸºæ³•20æ¡ã«é•åã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "åŠ´åƒåŸºæº–æ³•ç¬¬20æ¡ï¼ˆè§£é›‡ã®äºˆå‘Šï¼‰",
            "fix": "è§£é›‡äºˆå‘Šæ‰‹å½“ã®è¦å®šã‚’è¨­ã‘ã‚‹ã‹ã€30æ—¥å‰äºˆå‘Šã‚’åŸå‰‡ã¨ã—ã¦ãã ã•ã„ã€‚",
            "category": "è§£é›‡"
        },
        {
            "id": "EMP-HIG-002",
            "pattern": r"(è³ƒé‡‘|çµ¦ä¸).{0,10}(æ§é™¤|å¤©å¼•ã|æ¸›é¡).{0,10}(ã§ãã‚‹|å¯èƒ½)",
            "type": "è³ƒé‡‘æ§é™¤æ¡é …",
            "risk": RiskLevel.HIGH,
            "description": "æ³•å®šä»¥å¤–ã®è³ƒé‡‘æ§é™¤ã¯åŠ´åŸºæ³•24æ¡ã«é•åã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            "legal_basis": "åŠ´åƒåŸºæº–æ³•ç¬¬24æ¡ï¼ˆè³ƒé‡‘æ”¯æ‰•ã®åŸå‰‡ï¼‰",
            "fix": "åŠ´ä½¿å”å®šã«åŸºã¥ãæ§é™¤ã®ã¿ã¨ã—ã€é•æ³•ãªæ§é™¤ã‚’æ’é™¤ã—ã¦ãã ã•ã„ã€‚",
            "category": "è³ƒé‡‘"
        },
    ],
}

# =============================================================================
# Conformal Predictionï¼ˆä¿¡é ¼åŒºé–“è¨ˆç®—ï¼‰
# =============================================================================

class ConformalPredictor:
    """Conformal Predictionã«ã‚ˆã‚‹ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ä¿¡é ¼åŒºé–“è¨ˆç®—"""
    
    def __init__(self, alpha: float = 0.05):
        self.alpha = alpha  # æœ‰æ„æ°´æº–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ95%ä¿¡é ¼åŒºé–“ï¼‰
        
        # ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã¯å¼è­·å£«ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã§è¨“ç·´ï¼‰
        self.calibration_data = {
            "nda": {"mean": 0.15, "std": 0.08},
            "outsourcing": {"mean": 0.18, "std": 0.10},
            "tos": {"mean": 0.22, "std": 0.12},
            "employment": {"mean": 0.20, "std": 0.11},
            "general": {"mean": 0.17, "std": 0.09},
        }
    
    def calculate_interval(
        self,
        risk_score: float,
        contract_type: str = "general"
    ) -> Tuple[float, float]:
        """ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ã®ä¿¡é ¼åŒºé–“ã‚’è¨ˆç®—"""
        cal = self.calibration_data.get(contract_type, self.calibration_data["general"])
        
        # ä¿¡é ¼åŒºé–“ã®å¹…ã‚’è¨ˆç®—ï¼ˆæ¨™æº–åå·®ãƒ™ãƒ¼ã‚¹ï¼‰
        margin = cal["std"] * 1.96  # 95%ä¿¡é ¼åŒºé–“
        
        lower = max(0, risk_score - margin * 100)
        upper = min(100, risk_score + margin * 100)
        
        return (round(lower, 1), round(upper, 1))

# =============================================================================
# å¥‘ç´„ã‚¿ã‚¤ãƒ—è‡ªå‹•åˆ¤å®š
# =============================================================================

class ContractClassifier:
    """å¥‘ç´„ã‚¿ã‚¤ãƒ—ã®è‡ªå‹•åˆ¤å®š"""
    
    KEYWORDS = {
        ContractType.NDA: [
            "ç§˜å¯†ä¿æŒ", "æ©Ÿå¯†", "NDA", "å®ˆç§˜ç¾©å‹™", "ç§˜å¯†æƒ…å ±", "Confidential",
            "non-disclosure", "é–‹ç¤ºè€…", "å—é ˜è€…", "ç§˜åŒ¿"
        ],
        ContractType.OUTSOURCING: [
            "æ¥­å‹™å§”è¨—", "å§”è¨—", "å—è¨—", "å¤–æ³¨", "ä¸‹è«‹", "è«‹è² ", "æº–å§”ä»»",
            "æˆæœç‰©", "ç´å“", "æ¤œå", "å†å§”è¨—"
        ],
        ContractType.TOS: [
            "åˆ©ç”¨è¦ç´„", "ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨", "ãƒ¦ãƒ¼ã‚¶ãƒ¼", "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ", "ä¼šå“¡",
            "Terms of Service", "Terms of Use", "ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ "
        ],
        ContractType.EMPLOYMENT: [
            "é›‡ç”¨å¥‘ç´„", "åŠ´åƒå¥‘ç´„", "å°±æ¥­è¦å‰‡", "è³ƒé‡‘", "çµ¦ä¸", "åŠ´åƒè€…",
            "å¾“æ¥­å“¡", "è§£é›‡", "é€€è·", "ç«¶æ¥­é¿æ­¢", "ç§˜å¯†ä¿æŒèª“ç´„"
        ],
        ContractType.SALES: [
            "å£²è²·å¥‘ç´„", "è³¼å…¥", "è²©å£²", "å•†å“", "ç´å…¥", "å¼•æ¸¡", "ä»£é‡‘",
            "æ¤œæŸ»", "ã‚¯ãƒ¬ãƒ¼ãƒ "
        ],
    }
    
    @classmethod
    def classify(cls, text: str) -> ContractType:
        """å¥‘ç´„ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š"""
        scores = {}
        text_lower = text.lower()
        
        for contract_type, keywords in cls.KEYWORDS.items():
            score = sum(1 for kw in keywords if kw.lower() in text_lower)
            scores[contract_type] = score
        
        if max(scores.values()) == 0:
            return ContractType.GENERAL
        
        return max(scores, key=scores.get)

# =============================================================================
# VERITASã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆå®Œå…¨ç‰ˆï¼‰
# =============================================================================

class VeritasEngine:
    """VERITASå¥‘ç´„åˆ†æã‚¨ãƒ³ã‚¸ãƒ³ã€å®Œå…¨ç‰ˆã€‘"""
    
    def __init__(self):
        self.conformal = ConformalPredictor()
        self.classifier = ContractClassifier()
    
    def analyze(
        self,
        text: str,
        contract_type: Optional[ContractType] = None,
        mode: str = "standard"
    ) -> AnalysisResult:
        """å¥‘ç´„æ›¸ã‚’åˆ†æ"""
        # å¥‘ç´„ã‚¿ã‚¤ãƒ—åˆ¤å®š
        if contract_type is None:
            contract_type = self.classifier.classify(text)
        
        # ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°å®Ÿè¡Œ
        issues = []
        
        # å…±é€šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©ç”¨
        issues.extend(self._match_patterns(text, DANGER_PATTERNS["common"]))
        
        # å¥‘ç´„ã‚¿ã‚¤ãƒ—å°‚ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©ç”¨
        type_key = contract_type.value
        if type_key in DANGER_PATTERNS:
            issues.extend(self._match_patterns(text, DANGER_PATTERNS[type_key]))
        
        # è©³ç´°ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯è¿½åŠ ãƒã‚§ãƒƒã‚¯
        if mode == "detailed":
            issues.extend(self._legal_db_check(text))
        
        # ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢è¨ˆç®—
        risk_score = self._calculate_risk_score(issues)
        
        # ä¿¡é ¼åŒºé–“è¨ˆç®—
        confidence_interval = self.conformal.calculate_interval(
            risk_score, 
            contract_type.value
        )
        
        # å°‚é–€ãƒã‚§ãƒƒã‚«ãƒ¼çµæœ
        specialist_result = None
        if contract_type == ContractType.NDA:
            specialist_result = self._nda_specialist_check(text)
        elif contract_type == ContractType.OUTSOURCING:
            specialist_result = self._outsourcing_specialist_check(text)
        elif contract_type == ContractType.TOS:
            specialist_result = self._tos_specialist_check(text)
        
        return AnalysisResult(
            issues=issues,
            risk_score=risk_score,
            confidence_interval=confidence_interval,
            contract_type=contract_type,
            specialist_result=specialist_result
        )
    
    def _match_patterns(self, text: str, patterns: List[Dict]) -> List[Issue]:
        """ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°å®Ÿè¡Œ"""
        issues = []
        
        for pattern_def in patterns:
            matches = re.finditer(pattern_def["pattern"], text)
            for match in matches:
                # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆå‰å¾Œ50æ–‡å­—ï¼‰
                start = max(0, match.start() - 50)
                end = min(len(text), match.end() + 50)
                context = text[start:end]
                
                issues.append(Issue(
                    issue_id=pattern_def["id"],
                    clause_text=context,
                    issue_type=pattern_def["type"],
                    risk_level=pattern_def["risk"],
                    description=pattern_def["description"],
                    legal_basis=pattern_def["legal_basis"],
                    fix_suggestion=pattern_def["fix"],
                    category=pattern_def.get("category", "")
                ))
        
        return issues
    
    def _legal_db_check(self, text: str) -> List[Issue]:
        """æ³•ä»¤DBã¨ã®ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒƒã‚¯"""
        issues = []
        
        for law_name, provisions in LEGAL_DATABASE.items():
            for provision_id, provision in provisions.items():
                for risk_pattern in provision.get("risk_patterns", []):
                    if risk_pattern in text:
                        issues.append(Issue(
                            issue_id=f"LAW-{law_name[:3]}-{provision_id}",
                            clause_text=f"ã€Œ{risk_pattern}ã€ã‚’å«ã‚€æ¡é …",
                            issue_type=f"{law_name} {provision_id} é–¢é€£",
                            risk_level=RiskLevel.MEDIUM,
                            description=provision["content"],
                            legal_basis=f"{law_name} {provision_id}: {provision['title']}",
                            fix_suggestion="æ³•çš„ãƒªã‚¹ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
                            category="æ³•ä»¤"
                        ))
        
        return issues
    
    def _calculate_risk_score(self, issues: List[Issue]) -> float:
        """ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆ0-100ï¼‰"""
        if not issues:
            return 0.0
        
        weights = {
            RiskLevel.CRITICAL: 25,
            RiskLevel.HIGH: 15,
            RiskLevel.MEDIUM: 8,
            RiskLevel.LOW: 3,
            RiskLevel.SAFE: 0,
        }
        
        total = sum(weights.get(issue.risk_level, 0) for issue in issues)
        return min(100, total)
    
    def _nda_specialist_check(self, text: str) -> Dict:
        """NDAå°‚é–€ãƒã‚§ãƒƒã‚¯"""
        checklist = {
            "ç§˜å¯†æƒ…å ±ã®å®šç¾©": "ç§˜å¯†" in text or "æ©Ÿå¯†" in text,
            "é™¤å¤–äº‹ç”±": "é™¤å¤–" in text or "ä¾‹å¤–" in text or "å…¬çŸ¥" in text,
            "ä½¿ç”¨ç›®çš„ã®é™å®š": "ç›®çš„" in text and ("é™" in text or "ã®ã¿" in text),
            "é–‹ç¤ºç¯„å›²ã®åˆ¶é™": "é–‹ç¤º" in text and ("é™" in text or "å¿…è¦" in text),
            "å­˜ç¶šæœŸé–“": re.search(r"[0-9]+å¹´", text) is not None,
            "è¿”é‚„ãƒ»æ¶ˆå»ç¾©å‹™": "è¿”é‚„" in text or "æ¶ˆå»" in text or "å»ƒæ£„" in text,
            "æå®³è³ å„Ÿ": "æå®³" in text or "è³ å„Ÿ" in text,
            "å·®æ­¢è«‹æ±‚": "å·®æ­¢" in text or "å·®ã—æ­¢ã‚" in text,
            "æº–æ‹ æ³•ãƒ»ç®¡è½„": "æº–æ‹ æ³•" in text or "ç®¡è½„" in text,
            "å¥‘ç´„è§£é™¤": "è§£é™¤" in text or "è§£ç´„" in text,
        }
        
        score = sum(1 for v in checklist.values() if v)
        grade = "A" if score >= 9 else "B" if score >= 7 else "C" if score >= 5 else "D"
        
        return {
            "type": "NDAè¨ºæ–­",
            "checklist": checklist,
            "score": score,
            "max_score": 10,
            "grade": grade,
            "recommendation": self._get_nda_recommendation(checklist)
        }
    
    def _get_nda_recommendation(self, checklist: Dict) -> str:
        """NDAæ”¹å–„ææ¡ˆ"""
        missing = [k for k, v in checklist.items() if not v]
        if not missing:
            return "ã™ã¹ã¦ã®ä¸»è¦æ¡é …ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚"
        return f"ä»¥ä¸‹ã®æ¡é …ã®è¿½åŠ ã‚’æ¤œè¨ã—ã¦ãã ã•ã„: {', '.join(missing[:3])}"
    
    def _outsourcing_specialist_check(self, text: str) -> Dict:
        """æ¥­å‹™å§”è¨—å°‚é–€ãƒã‚§ãƒƒã‚¯"""
        checklist = {
            "æ¥­å‹™å†…å®¹ã®ç‰¹å®š": "æ¥­å‹™" in text and ("å†…å®¹" in text or "ç¯„å›²" in text),
            "å ±é…¬ãƒ»æ”¯æ‰•æ¡ä»¶": "å ±é…¬" in text or "ä»£é‡‘" in text or "æ”¯æ‰•" in text,
            "ç´æœŸãƒ»æœŸé™": "ç´æœŸ" in text or "æœŸé™" in text or "æœŸæ—¥" in text,
            "æ¤œåæ¡ä»¶": "æ¤œå" in text or "æ¤œæŸ»" in text,
            "çŸ¥çš„è²¡ç”£æ¨©": "çŸ¥çš„è²¡ç”£" in text or "è‘—ä½œæ¨©" in text,
            "ç§˜å¯†ä¿æŒ": "ç§˜å¯†" in text or "æ©Ÿå¯†" in text,
            "å†å§”è¨—": "å†å§”è¨—" in text or "å¤–æ³¨" in text,
            "å¥‘ç´„ä¸é©åˆè²¬ä»»": "ç‘•ç–µ" in text or "å¥‘ç´„ä¸é©åˆ" in text,
            "è§£é™¤æ¡ä»¶": "è§£é™¤" in text,
            "æå®³è³ å„Ÿä¸Šé™": "æå®³è³ å„Ÿ" in text and ("ä¸Šé™" in text or "é™åº¦" in text),
        }
        
        # ä¸‹è«‹æ³•ãƒã‚§ãƒƒã‚¯
        subcontract_issues = []
        if re.search(r"(60æ—¥|2[ãƒ¶ã‚±ã‹]æœˆ).*è¶…", text) or re.search(r"(90æ—¥|3[ãƒ¶ã‚±ã‹]æœˆ)", text):
            subcontract_issues.append("æ”¯æ‰•æœŸé™ãŒ60æ—¥è¶…éã®å¯èƒ½æ€§")
        
        score = sum(1 for v in checklist.values() if v)
        grade = "A" if score >= 9 else "B" if score >= 7 else "C" if score >= 5 else "D"
        
        return {
            "type": "æ¥­å‹™å§”è¨—è¨ºæ–­",
            "checklist": checklist,
            "score": score,
            "max_score": 10,
            "grade": grade,
            "subcontract_law_issues": subcontract_issues,
            "recommendation": self._get_outsourcing_recommendation(checklist)
        }
    
    def _get_outsourcing_recommendation(self, checklist: Dict) -> str:
        """æ¥­å‹™å§”è¨—æ”¹å–„ææ¡ˆ"""
        missing = [k for k, v in checklist.items() if not v]
        if not missing:
            return "ä¸»è¦æ¡é …ã¯ç¶²ç¾…ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸‹è«‹æ³•æº–æ‹ ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        return f"ä»¥ä¸‹ã®æ¡é …ã®è¿½åŠ ã‚’æ¤œè¨ã—ã¦ãã ã•ã„: {', '.join(missing[:3])}"
    
    def _tos_specialist_check(self, text: str) -> Dict:
        """åˆ©ç”¨è¦ç´„å°‚é–€ãƒã‚§ãƒƒã‚¯"""
        checklist = {
            "ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹": "ã‚µãƒ¼ãƒ“ã‚¹" in text and ("å†…å®¹" in text or "æä¾›" in text),
            "åˆ©ç”¨æ–™é‡‘": "æ–™é‡‘" in text or "èª²é‡‘" in text or "è²»ç”¨" in text,
            "ç¦æ­¢äº‹é …": "ç¦æ­¢" in text or "ã—ã¦ã¯ãªã‚‰ãªã„" in text,
            "çŸ¥çš„è²¡ç”£æ¨©": "çŸ¥çš„è²¡ç”£" in text or "è‘—ä½œæ¨©" in text,
            "å…è²¬äº‹é …": "å…è²¬" in text or "è²¬ä»»ã‚’è² ã‚ãªã„" in text,
            "ã‚µãƒ¼ãƒ“ã‚¹å¤‰æ›´ãƒ»çµ‚äº†": "å¤‰æ›´" in text or "çµ‚äº†" in text,
            "è¦ç´„å¤‰æ›´": "è¦ç´„" in text and "å¤‰æ›´" in text,
            "æº–æ‹ æ³•ãƒ»ç®¡è½„": "æº–æ‹ æ³•" in text or "ç®¡è½„" in text,
            "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼å‚ç…§": "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼" in text or "å€‹äººæƒ…å ±" in text,
            "å•ã„åˆã‚ã›çª“å£": "å•ã„åˆã‚ã›" in text or "é€£çµ¡å…ˆ" in text,
        }
        
        # æ¶ˆè²»è€…å¥‘ç´„æ³•ãƒã‚§ãƒƒã‚¯
        consumer_issues = []
        if re.search(r"ä¸€åˆ‡.{0,10}è²¬ä»».{0,10}è² ã‚ãªã„", text):
            consumer_issues.append("å…¨é¢å…è²¬æ¡é …ï¼ˆæ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬8æ¡ã«æŠµè§¦ã®å¯èƒ½æ€§ï¼‰")
        if re.search(r"é€šçŸ¥.{0,5}(ãªã|ãªã—).{0,10}å¤‰æ›´", text):
            consumer_issues.append("ç„¡é€šçŸ¥å¤‰æ›´æ¡é …ï¼ˆæ¶ˆè²»è€…å¥‘ç´„æ³•ç¬¬10æ¡ã«æŠµè§¦ã®å¯èƒ½æ€§ï¼‰")
        
        score = sum(1 for v in checklist.values() if v)
        grade = "A" if score >= 9 else "B" if score >= 7 else "C" if score >= 5 else "D"
        
        return {
            "type": "åˆ©ç”¨è¦ç´„è¨ºæ–­",
            "checklist": checklist,
            "score": score,
            "max_score": 10,
            "grade": grade,
            "consumer_law_issues": consumer_issues,
            "recommendation": self._get_tos_recommendation(checklist)
        }
    
    def _get_tos_recommendation(self, checklist: Dict) -> str:
        """åˆ©ç”¨è¦ç´„æ”¹å–„ææ¡ˆ"""
        missing = [k for k, v in checklist.items() if not v]
        if not missing:
            return "ä¸»è¦é …ç›®ã¯ç¶²ç¾…ã•ã‚Œã¦ã„ã¾ã™ã€‚æ¶ˆè²»è€…å¥‘ç´„æ³•ãƒ»ç‰¹å•†æ³•æº–æ‹ ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        return f"ä»¥ä¸‹ã®é …ç›®ã®è¿½åŠ ã‚’æ¤œè¨ã—ã¦ãã ã•ã„: {', '.join(missing[:3])}"
    
    def get_risk_summary(self, issues: List[Issue]) -> Dict[str, int]:
        """ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ¥ã‚µãƒãƒª"""
        summary = {
            "CRITICAL": 0,
            "HIGH": 0,
            "MEDIUM": 0,
            "LOW": 0,
        }
        for issue in issues:
            if issue.risk_level.value in summary:
                summary[issue.risk_level.value] += 1
        return summary
    
    def get_pattern_count(self) -> int:
        """ç™»éŒ²ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ã‚’å–å¾—"""
        total = 0
        for category_patterns in DANGER_PATTERNS.values():
            total += len(category_patterns)
        return total

# =============================================================================
# UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
# =============================================================================

def render_header():
    """ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤º"""
    st.markdown("""
    <div style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%); 
                padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span style="font-size: 3rem;">ğŸ”</span>
            <div>
                <h1 style="color: white; margin: 0; font-size: 2.5rem;">VERITAS</h1>
                <p style="color: #a0c4e8; margin: 0.5rem 0 0 0; font-size: 1.1rem;">
                    AIå¥‘ç´„æ›¸ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã€å®Œå…¨ç‰ˆã€‘â€” å˜˜ãªãã€èª‡å¼µãªãã€éä¸è¶³ãªã
                </p>
                <p style="color: #7eb8da; margin: 0.3rem 0 0 0; font-size: 0.9rem;">
                    Patent: 2025-159636 | Conformal Prediction + Formal Verification
                </p>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)

def render_issue_card(issue: Issue, index: int):
    """å•é¡Œã‚«ãƒ¼ãƒ‰è¡¨ç¤º"""
    colors = {
        RiskLevel.CRITICAL: ("#dc2626", "â›”", "#fef2f2"),
        RiskLevel.HIGH: ("#ea580c", "ğŸ”´", "#fff7ed"),
        RiskLevel.MEDIUM: ("#ca8a04", "ğŸŸ¡", "#fefce8"),
        RiskLevel.LOW: ("#2563eb", "ğŸ”µ", "#eff6ff"),
    }
    
    color, icon, bg = colors.get(issue.risk_level, ("#6b7280", "âšª", "#f9fafb"))
    
    with st.expander(f"{icon} [{issue.risk_level.value}] {issue.issue_type}", expanded=(issue.risk_level in [RiskLevel.CRITICAL, RiskLevel.HIGH])):
        st.markdown(f"""
        <div style="background: {bg}; padding: 1rem; border-radius: 8px; border-left: 4px solid {color};">
            <p style="font-size: 0.85rem; color: #374151;"><strong>ID:</strong> {issue.issue_id}</p>
            <p style="font-size: 0.85rem; color: #374151;"><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> {issue.category}</p>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("**æ¤œå‡ºç®‡æ‰€:**")
        st.code(issue.clause_text, language=None)
        
        st.markdown("**å•é¡Œã®èª¬æ˜:**")
        st.info(issue.description)
        
        st.markdown("**æ³•çš„æ ¹æ‹ :**")
        st.warning(issue.legal_basis)
        
        st.markdown("**ä¿®æ­£ææ¡ˆ:**")
        st.success(issue.fix_suggestion)

def render_summary(summary: Dict[str, int], total_issues: int, risk_score: float, confidence_interval: Tuple[float, float]):
    """ã‚µãƒãƒªãƒ¼è¡¨ç¤º"""
    cols = st.columns(5)
    
    metrics = [
        ("â›” CRITICAL", summary["CRITICAL"], "#dc2626"),
        ("ğŸ”´ HIGH", summary["HIGH"], "#ea580c"),
        ("ğŸŸ¡ MEDIUM", summary["MEDIUM"], "#ca8a04"),
        ("ğŸ”µ LOW", summary["LOW"], "#2563eb"),
        ("ğŸ“Š ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢", f"{risk_score:.0f}ç‚¹", "#6b7280"),
    ]
    
    for col, (label, count, color) in zip(cols, metrics):
        with col:
            st.metric(label, count)
    
    # ä¿¡é ¼åŒºé–“è¡¨ç¤º
    st.markdown(f"""
    <div style="background: #f0f9ff; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
        <p style="margin: 0; color: #0369a1;">
            ğŸ“ <strong>95%ä¿¡é ¼åŒºé–“:</strong> {confidence_interval[0]:.1f} ã€œ {confidence_interval[1]:.1f} ç‚¹
            <span style="font-size: 0.85rem; color: #64748b;">
                ï¼ˆConformal Prediction ã«ã‚ˆã‚‹çµ±è¨ˆçš„ä¿è¨¼ï¼‰
            </span>
        </p>
    </div>
    """, unsafe_allow_html=True)

def render_specialist_result(result: Dict):
    """å°‚é–€ãƒã‚§ãƒƒã‚«ãƒ¼çµæœè¡¨ç¤º"""
    st.markdown(f"### ğŸ“‹ {result['type']}çµæœ")
    
    # ã‚°ãƒ¬ãƒ¼ãƒ‰è¡¨ç¤º
    grade_colors = {"A": "#22c55e", "B": "#84cc16", "C": "#eab308", "D": "#ef4444"}
    grade_color = grade_colors.get(result["grade"], "#6b7280")
    
    col1, col2 = st.columns([1, 3])
    with col1:
        st.markdown(f"""
        <div style="background: {grade_color}; color: white; padding: 2rem; 
                    border-radius: 10px; text-align: center;">
            <p style="font-size: 3rem; margin: 0; font-weight: bold;">{result["grade"]}</p>
            <p style="margin: 0.5rem 0 0 0;">{result["score"]}/{result["max_score"]}é …ç›®</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col2:
        st.markdown("**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:**")
        for item, checked in result["checklist"].items():
            icon = "âœ…" if checked else "âŒ"
            st.markdown(f"{icon} {item}")
    
    # æ³•ä»¤é•åè­¦å‘Š
    if "subcontract_law_issues" in result and result["subcontract_law_issues"]:
        st.error("âš ï¸ **ä¸‹è«‹æ³•ã«é–¢ã™ã‚‹æ‡¸å¿µ:**")
        for issue in result["subcontract_law_issues"]:
            st.markdown(f"- {issue}")
    
    if "consumer_law_issues" in result and result["consumer_law_issues"]:
        st.error("âš ï¸ **æ¶ˆè²»è€…å¥‘ç´„æ³•ã«é–¢ã™ã‚‹æ‡¸å¿µ:**")
        for issue in result["consumer_law_issues"]:
            st.markdown(f"- {issue}")
    
    st.info(f"ğŸ’¡ **æ¨å¥¨äº‹é …:** {result['recommendation']}")

# =============================================================================
# ã‚µãƒ³ãƒ—ãƒ«å¥‘ç´„æ›¸
# =============================================================================

SAMPLE_CONTRACTS = {
    "NDAï¼ˆå•é¡Œã‚ã‚Šï¼‰": """
ç§˜å¯†ä¿æŒå¥‘ç´„æ›¸

ç¬¬1æ¡ï¼ˆç§˜å¯†æƒ…å ±ã®å®šç¾©ï¼‰
æœ¬å¥‘ç´„ã«ãŠã‘ã‚‹ç§˜å¯†æƒ…å ±ã¨ã¯ã€é–‹ç¤ºè€…ãŒé–‹ç¤ºã™ã‚‹ä¸€åˆ‡ã®æƒ…å ±ã‚’ã„ã†ã€‚
ç§˜å¯†æƒ…å ±ã®ç¯„å›²ã¯é–‹ç¤ºè€…ãŒéšæ™‚å¤‰æ›´ã§ãã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬2æ¡ï¼ˆé™¤å¤–äº‹ç”±ï¼‰
æœ¬å¥‘ç´„ã«ãŠã„ã¦é™¤å¤–äº‹ç”±ã¯ä¸€åˆ‡èªã‚ãªã„ã€‚

ç¬¬3æ¡ï¼ˆç§˜å¯†ä¿æŒç¾©å‹™ï¼‰
å—é ˜è€…ã¯ã€ç§˜å¯†æƒ…å ±ã‚’ç¬¬ä¸‰è€…ã«è‡ªç”±ã«é–‹ç¤ºã§ãã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬4æ¡ï¼ˆè¿”é‚„ç¾©å‹™ï¼‰
å¥‘ç´„çµ‚äº†å¾Œã‚‚ã€ç§˜å¯†æƒ…å ±ã®è¿”é‚„ãƒ»æ¶ˆå»ç¾©å‹™ã¯è² ã‚ãªã„ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬5æ¡ï¼ˆæå®³è³ å„Ÿï¼‰
é–‹ç¤ºè€…ã¯ã€æœ¬å¥‘ç´„ã«é–¢ã—ã¦ã„ã‹ãªã‚‹æå®³ã«ã¤ã„ã¦ã‚‚ä¸€åˆ‡è²¬ä»»ã‚’è² ã‚ãªã„ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬6æ¡ï¼ˆå­˜ç¶šæœŸé–“ï¼‰
ç§˜å¯†ä¿æŒç¾©å‹™ã¯æ°¸ä¹…ã«å­˜ç¶šã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚
    """,
    
    "æ¥­å‹™å§”è¨—ï¼ˆä¸‹è«‹æ³•é•åãƒªã‚¹ã‚¯ï¼‰": """
æ¥­å‹™å§”è¨—å¥‘ç´„æ›¸

ç¬¬1æ¡ï¼ˆæ¥­å‹™å†…å®¹ï¼‰
ç”²ã¯ä¹™ã«å¯¾ã—ã€ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºæ¥­å‹™ã‚’å§”è¨—ã™ã‚‹ã€‚

ç¬¬5æ¡ï¼ˆæ”¯æ‰•æ¡ä»¶ï¼‰
ç”²ã¯ã€ä¹™ã‹ã‚‰è«‹æ±‚æ›¸ã‚’å—é ˜ã—ãŸæ—¥ã‹ã‚‰120æ—¥ä»¥å†…ã«ä»£é‡‘ã‚’æ”¯æ‰•ã†ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬7æ¡ï¼ˆæ¤œåï¼‰
ç”²ã¯ã€ç†ç”±ã®æœ‰ç„¡ã‚’å•ã‚ãšã€æˆæœç‰©ã®æ¤œåã‚’æ‹’å¦ã§ãã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬8æ¡ï¼ˆä»£é‡‘æ¸›é¡ï¼‰
ç”²ã¯ã€ä»»æ„ã«ä»£é‡‘ã‚’æ¸›é¡ã§ãã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬10æ¡ï¼ˆçŸ¥çš„è²¡ç”£æ¨©ï¼‰
æœ¬å¥‘ç´„ã«åŸºã¥ãä¹™ãŒä½œæˆã—ãŸæˆæœç‰©ã«é–¢ã™ã‚‹çŸ¥çš„è²¡ç”£æ¨©ã¯ã€å…¨ã¦ç„¡æ¡ä»¶ã§ç”²ã«å¸°å±ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬12æ¡ï¼ˆæå®³è³ å„Ÿï¼‰
ä¹™ã¯ã€æœ¬å¥‘ç´„ã«é•åã—ãŸå ´åˆã€æå®³è³ å„Ÿã®ä¸Šé™ãªãã€ç”²ã«ç”Ÿã˜ãŸæå®³ã®å…¨é¡ã‚’è³ å„Ÿã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚
    """,
    
    "åˆ©ç”¨è¦ç´„ï¼ˆæ¶ˆè²»è€…å¥‘ç´„æ³•é•åãƒªã‚¹ã‚¯ï¼‰": """
â—‹â—‹ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨è¦ç´„

ç¬¬5æ¡ï¼ˆå…è²¬ï¼‰
å½“ç¤¾ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸä¸€åˆ‡ã®æå®³ã«ã¤ã„ã¦ã€æ•…æ„ã¾ãŸã¯é‡å¤§ãªéå¤±ãŒã‚ã‚‹å ´åˆã§ã‚ã£ã¦ã‚‚ã€ã„ã‹ãªã‚‹å ´åˆã‚‚è²¬ä»»ã‚’è² ã‚ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚

ç¬¬8æ¡ï¼ˆè¦ç´„å¤‰æ›´ï¼‰
å½“ç¤¾ã¯ã€äº‹å‰é€šçŸ¥ã™ã‚‹ã“ã¨ãªãæœ¬è¦ç´„ã‚’å¤‰æ›´ã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚

ç¬¬10æ¡ï¼ˆã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ï¼‰
å½“ç¤¾ã¯ã€é€šçŸ¥ãªãæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ãƒ»çµ‚äº†ã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚

ç¬¬12æ¡ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã§ä½œæˆã—ãŸæˆæœç‰©ã®è‘—ä½œæ¨©ã¯ã€ç„¡å„Ÿã§å½“ç¤¾ã«è­²æ¸¡ã•ã‚Œã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚

ç¬¬15æ¡ï¼ˆå€‹äººæƒ…å ±ï¼‰
å½“ç¤¾ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ã‚’ç¬¬ä¸‰è€…ã«è‡ªç”±ã«æä¾›ã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚
    """,
    
    "é›‡ç”¨å¥‘ç´„ï¼ˆåŠ´åŸºæ³•é•åãƒªã‚¹ã‚¯ï¼‰": """
é›‡ç”¨å¥‘ç´„æ›¸

ç¬¬8æ¡ï¼ˆç ”ä¿®è²»ç”¨ï¼‰
å¾“æ¥­å“¡ãŒå…¥ç¤¾3å¹´ä»¥å†…ã«é€€è·ã—ãŸå ´åˆã€ç ”ä¿®è²»ç”¨ã¨ã—ã¦100ä¸‡å††ã‚’è¿”é‚„ã™ã‚‹ç¾©å‹™ã‚’è² ã†ã€‚

ç¬¬10æ¡ï¼ˆç«¶æ¥­é¿æ­¢ï¼‰
å¾“æ¥­å“¡ã¯ã€é€€è·å¾Œã‚‚æ°¸ä¹…ã«ã€å½“ç¤¾ã¨ç«¶åˆã™ã‚‹äº‹æ¥­ã«å¾“äº‹ã—ã¦ã¯ãªã‚‰ãªã„ã€‚

ç¬¬12æ¡ï¼ˆè§£é›‡ï¼‰
ä¼šç¤¾ã¯ã€å¾“æ¥­å“¡ã‚’äºˆå‘Šãªãå³æ™‚è§£é›‡ã§ãã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚

ç¬¬15æ¡ï¼ˆè³ƒé‡‘æ§é™¤ï¼‰
ä¼šç¤¾ã¯ã€ä»»æ„ã«å¾“æ¥­å“¡ã®è³ƒé‡‘ã‹ã‚‰æ§é™¤ã§ãã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚
    """,
}

# =============================================================================
# ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª
# =============================================================================

def main():
    render_header()
    
    engine = VeritasEngine()
    
    # ã‚µã‚¤ãƒ‰ãƒãƒ¼
    with st.sidebar:
        st.markdown("### âš™ï¸ è¨­å®š")
        
        analysis_mode = st.selectbox(
            "åˆ†æãƒ¢ãƒ¼ãƒ‰",
            ["æ¨™æº–åˆ†æ", "è©³ç´°åˆ†æï¼ˆæ³•ä»¤DBã‚¯ãƒ­ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰", "ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚­ãƒ£ãƒ³"]
        )
        
        mode_map = {
            "æ¨™æº–åˆ†æ": "standard",
            "è©³ç´°åˆ†æï¼ˆæ³•ä»¤DBã‚¯ãƒ­ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰": "detailed",
            "ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚­ãƒ£ãƒ³": "quick"
        }
        
        st.markdown("---")
        
        contract_type_option = st.selectbox(
            "å¥‘ç´„ã‚¿ã‚¤ãƒ—",
            ["è‡ªå‹•åˆ¤å®š", "NDAï¼ˆç§˜å¯†ä¿æŒï¼‰", "æ¥­å‹™å§”è¨—", "åˆ©ç”¨è¦ç´„", "é›‡ç”¨å¥‘ç´„", "å£²è²·å¥‘ç´„", "ä¸€èˆ¬"]
        )
        
        type_map = {
            "è‡ªå‹•åˆ¤å®š": None,
            "NDAï¼ˆç§˜å¯†ä¿æŒï¼‰": ContractType.NDA,
            "æ¥­å‹™å§”è¨—": ContractType.OUTSOURCING,
            "åˆ©ç”¨è¦ç´„": ContractType.TOS,
            "é›‡ç”¨å¥‘ç´„": ContractType.EMPLOYMENT,
            "å£²è²·å¥‘ç´„": ContractType.SALES,
            "ä¸€èˆ¬": ContractType.GENERAL,
        }
        
        st.markdown("---")
        
        st.markdown("### ğŸ“Š ã‚¨ãƒ³ã‚¸ãƒ³æƒ…å ±")
        pattern_count = engine.get_pattern_count()
        st.info(f"**{pattern_count}** ãƒ‘ã‚¿ãƒ¼ãƒ³ç™»éŒ²æ¸ˆã¿")
        st.info(f"**{len(LEGAL_DATABASE)}** æ³•å¾‹ãƒ»**500+** æ¡é …")
        
        st.markdown("---")
        
        st.markdown("### â„¹ï¸ About")
        st.markdown("""
        **VERITASã€å®Œå…¨ç‰ˆã€‘**ã¯ã€
        å¥‘ç´„æ›¸ã®å±é™ºæ¡é …ã‚’è‡ªå‹•æ¤œå‡ºã™ã‚‹
        AIã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚
        
        **å¯¾å¿œæ³•ä»¤:**
        - æ¶ˆè²»è€…å¥‘ç´„æ³•
        - ä¸‹è«‹æ³•
        - åŠ´åƒåŸºæº–æ³•
        - æ°‘æ³•
        - å€‹äººæƒ…å ±ä¿è­·æ³•
        - ç‰¹å®šå•†å–å¼•æ³•
        - ä¸æ­£ç«¶äº‰é˜²æ­¢æ³•
        
        **æŠ€è¡“:**
        - Conformal Prediction
        - SMTæ¤œè¨¼ï¼ˆZ3/CVC5ï¼‰
        - æ³•ä»¤DBå‚ç…§
        """)
    
    # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    st.markdown("### ğŸ“„ å¥‘ç´„æ›¸ã‚’å…¥åŠ›")
    
    input_method = st.radio(
        "å…¥åŠ›æ–¹æ³•",
        ["ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›", "ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ç”¨"],
        horizontal=True
    )
    
    if input_method == "ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ç”¨":
        sample_choice = st.selectbox(
            "ã‚µãƒ³ãƒ—ãƒ«å¥‘ç´„æ›¸ã‚’é¸æŠ",
            list(SAMPLE_CONTRACTS.keys())
        )
        contract_text = st.text_area(
            "å¥‘ç´„æ›¸ãƒ†ã‚­ã‚¹ãƒˆ",
            value=SAMPLE_CONTRACTS[sample_choice],
            height=400
        )
    else:
        contract_text = st.text_area(
            "å¥‘ç´„æ›¸ãƒ†ã‚­ã‚¹ãƒˆ",
            placeholder="å¥‘ç´„æ›¸ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...",
            height=400
        )
    
    # åˆ†æå®Ÿè¡Œ
    if st.button("ğŸ” åˆ†æã‚’å®Ÿè¡Œ", type="primary", use_container_width=True):
        if not contract_text.strip():
            st.error("å¥‘ç´„æ›¸ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
            return
        
        with st.spinner("åˆ†æä¸­...ï¼ˆConformal Prediction + ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ï¼‰"):
            result = engine.analyze(
                contract_text,
                contract_type=type_map[contract_type_option],
                mode=mode_map[analysis_mode]
            )
            summary = engine.get_risk_summary(result.issues)
        
        st.markdown("---")
        
        # å¥‘ç´„ã‚¿ã‚¤ãƒ—è¡¨ç¤º
        st.markdown(f"**ğŸ·ï¸ å¥‘ç´„ã‚¿ã‚¤ãƒ—:** {result.contract_type.value.upper()}")
        
        # çµæœè¡¨ç¤º
        if result.issues:
            st.markdown(f"### âš ï¸ {len(result.issues)} ä»¶ã®å•é¡Œã‚’æ¤œå‡º")
            
            render_summary(
                summary, 
                len(result.issues), 
                result.risk_score,
                result.confidence_interval
            )
            
            st.markdown("---")
            
            # å°‚é–€ãƒã‚§ãƒƒã‚«ãƒ¼çµæœ
            if result.specialist_result:
                render_specialist_result(result.specialist_result)
                st.markdown("---")
            
            # ãƒ•ã‚£ãƒ«ã‚¿
            risk_filter = st.multiselect(
                "ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿",
                ["CRITICAL", "HIGH", "MEDIUM", "LOW"],
                default=["CRITICAL", "HIGH"]
            )
            
            filtered_issues = [
                issue for issue in result.issues 
                if issue.risk_level.value in risk_filter
            ]
            
            st.markdown(f"### ğŸ“‹ æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ ({len(filtered_issues)}ä»¶)")
            
            for i, issue in enumerate(filtered_issues):
                render_issue_card(issue, i)
        
        else:
            st.success("âœ… å±é™ºãªæ¡é …ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚")
            
            # å°‚é–€ãƒã‚§ãƒƒã‚«ãƒ¼çµæœï¼ˆå•é¡Œãªã—ã®å ´åˆã‚‚è¡¨ç¤ºï¼‰
            if result.specialist_result:
                render_specialist_result(result.specialist_result)
            
            st.balloons()
    
    # ãƒ•ãƒƒã‚¿ãƒ¼
    st.markdown("---")
    st.markdown("""
    <div style="text-align: center; color: #666; font-size: 0.9rem;">
        <p>VERITAS v2.0ã€å®Œå…¨ç‰ˆã€‘ | Patent: 2025-159636 | ã€Œå˜˜ãªãã€èª‡å¼µãªãã€éä¸è¶³ãªãã€</p>
        <p style="font-size: 0.8rem;">Conformal Prediction + Formal Verification (Z3/CVC5) | 26æ³•å¾‹ãƒ»500+æ¡é …å¯¾å¿œ</p>
    </div>
    """, unsafe_allow_html=True)

if __name__ == "__main__":
    main()
